# فحص كامل للمشروع — عجلة الولاء وقلب البيانات وسجل الأدمن

## 1. سجل العضويات الجديدة (الزبون الجديد يظهر في صفحة الأدمن)

| الخطوة | الإجراء | النتيجة المتوقعة |
|--------|---------|-------------------|
| 1.1 | فتح صفحة الضيف (/) | تظهر العجلة وزر «اضغط هنا» و«تسجيل مجاني». |
| 1.2 | الضغط «تسجيل مجاني» أو «اضغط هنا» ثم إدخال رقم غير موجود ثم تسجيل (اسم + جوال + هوية) | يتم التسجيل ويُضاف العضو للفضية. |
| 1.3 | فتح صفحة الأدمن (/admin) | تظهر بطاقة «سجل العضويات الجديدة». |
| 1.4 | التحقق من السجل | يظهر صف بالجوال والاسم وتاريخ التسجيل للعضو الذي سجّل في 1.2. |
| 1.5 | (اختياري) الضغط «تحديث» | يتم تحديث القائمة. |
| 1.6 | بعد إضافة العضو يدوياً للفضي في الإكسيل، الضغط «مسح السجل» | يُفرغ السجل. |

**ملاحظة:** إذا كان Firebase مفعّلاً، السجل يُخزَّن في Firestore (مجموعة `new_members`) ويُعرض في الأدمن. بدون Firebase يُخزَّن في localStorage ويُعرض أيضاً.

---

## 2. قلب البيانات — البحث بالرقم من ملفات الإكسيل (فضي، ذهبي، بلاتيني، إيراد)

| الخطوة | الإجراء | النتيجة المتوقعة |
|--------|---------|-------------------|
| 2.1 | من صفحة الأدمن رفع ملف إكسيل **الزبائن الفضي** (عمود جوال + اسم) | يظهر عدد السجلات وتظهر رسالة نجاح. |
| 2.2 | رفع ملف **الزبائن الذهبي** و **البلاتيني** إن وُجد | نفس الشيء. |
| 2.3 | رفع ملف **كشف الإيراد** (جوال + إيراد/مبلغ) | يظهر عدد السجلات. |
| 2.4 | في الإعدادات ضبط **كل كم ريال = 1 نقطة** (مثلاً 10) | يُحفظ. |
| 2.5 | فتح صفحة الضيف → «اضغط هنا» → إدخال رقم موجود في ملف **الفضي** وله صف في **كشف الإيراد** | تظهر فئة **فضي** + **النقاط** = (إيراد هذا الرقم ÷ القيمة التي حددها الأدمن). |
| 2.6 | إدخال رقم موجود فقط في **الذهبي** | تظهر فئة **ذهبي** ونقاطه من الإيراد. |
| 2.7 | إدخال رقم موجود في **البلاتيني** | تظهر فئة **بلاتيني**. |
| 2.8 | إدخال رقم غير موجود في أي ملف | يظهر طلب التسجيل (عضو جديد). |

**معادلة النقاط:** `نقاط الزبون = round(إيراد الرقم من كشف الإيراد ÷ "كل كم ريال = 1 نقطة")`.

---

## 3. تشغيل الاختبار المجمع (آلي)

```bash
npm install
npm run test
```

للاختبار الكامل في المتصفح (كل الورك فلو والسيناريوهات): انظر **E2E_SCENARIOS.md** — فيه كل السيناريوهات خطوة بخطوة وعناصر `data-testid` للاستخدام مع Playwright أو الاختبار اليدوي.

**ما يختبره:**
- تسجيل عضو جديد → ظهوره في `getNewMembersLog()` (جوال، اسم، تاريخ).
- مسح السجل يفرغ القائمة.
- **قلب البيانات:** رقم في الفضي + إيراد مع revenueToPoints = 10 → الفئة فضّي والنقاط = إيراد ÷ 10.
- رقم في الذهبي/بلاتيني → الفئة الصحيحة والنقاط من الإيراد.
- رقم غير موجود → null.
- تغيير «كل كم ريال = 1 نقطة» (مثلاً 5) → النقاط = إيراد ÷ 5.

---

## 4. فحص سريع (بدون رفع ملفات)

- **بدون Firebase:** التأكد من وجود `.env` أو عدمه؛ إن لم يوجد، التطبيق يعمل من localStorage.
- **مع Firebase:** في الأدمن يظهر صندوق «فحص Firebase» — إن كان أخضر فالاتصال يعمل.
- **Lookup بدون بيانات:** إذا لم يرفع الأدمن أي إكسيل، إدخال أي رقم يعطي «عضو جديد» (لا توجد فئة).

---

## 5. ملخص التدفق

```
الأدمن يرفع 4 ملفات إكسيل (فضي، ذهبي، بلاتيني، إيراد)
    → تُخزَّن في Firestore و/أو localStorage

الضيف يفتح الصفحة ويدخل رقمه
    → البحث في الفضي ثم الذهبي ثم البلاتيني
    → النقاط من كشف الإيراد ÷ (كل كم ريال = 1 نقطة)
    → عرض الفئة + النقاط + النقاط المتبقية للترقية

الضيف الجديد يسجّل (اسم + جوال + هوية)
    → يُضاف للفضية
    → يُضاف لسجل «العضويات الجديدة» في الأدمن
    → الأدمن يرى السجل ويضمّهم لملف الإكسيل الفضي أو يمسح السجل بعد المعالجة
```
