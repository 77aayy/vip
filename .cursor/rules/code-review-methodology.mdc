---
description: طريقة المراجعة الدقيقة (مراجعة سنيور) — معتمدة كطريقة مراجعة دائمة مع الرولز العامة
alwaysApply: true
---

# طريقة المراجعة الدقيقة (Code Review Methodology)

عند طلب **مراجعة التعديلات** أو **مراجعة المشروع** أو **"راجع بشكل دقيق"** أو ما شابهها، اتبع الخطوات التالية بالترتيب. لا تكتفِ بقراءة سريعة؛ تتبع التدفق وافحص الحالات الحدية والتنظيف.

---

## 1. نطاق المراجعة

- حدد **الملفات/الميزات** المطلوب مراجعتها (إن وُجد). إن لم يُحدد، راجع آخر التعديلات أو الميزات الحرجة (دخول، أمان، دمج بيانات، صلاحيات).
- اقرأ **التدفق من البداية للنهاية** لكل مسار حرج (مثلاً: ضغط زر → استدعاء خدمة → تحديث حالة → واجهة).

---

## 2. قائمة التحقق (Checklist)

عند المراجعة، تحقق من كل بند ينطبق:

| البند | ماذا تتحقق |
|-------|------------|
| **التدفق (Flow)** | ترتيب الشروط صحيح (مثلاً: تحقق سيرفر أولاً، ثم Firestore، ثم محلي). لا مسار يكتب بيانات قبل تأكيد المستخدم إن كان مطلوباً (مثل معاينة قبل الدمج). |
| **الحالات الحدية** | وجود تحقق من `null` / `undefined` قبل استخدام كائنات (مثل `db`, `sessionStorage`, ناتج `getDoc`). تحقق من `typeof sessionStorage === 'undefined'` في كود يعمل في بيئات متعددة. |
| **مصدر الحقيقة** | عند وجود أكثر من مصدر (محلي + Firestore أو سيرفر)، هل القرار "من أين أقرأ/أكتب" واضح ولا تعارض؟ |
| **عدم الكتابة العشوائية** | عمليات دمج أو تحديث لا تُنفَّذ إلا بعد مطابقة واضحة (مثلاً 100% اسم + جوال أو هوية) أو بعد تأكيد المستخدم (معاينة ثم تطبيق). |
| **التنظيف (Cleanup)** | لا اشتراكات دائمة (`onSnapshot`, `addEventListener`) بدون إلغاء في `useEffect` return. لا intervals/timers بدون clear. |
| **التحقق من الإدخال** | حفظ إعدادات أو قيم حرجة يُسبق بتحقق (أرقام موجبة، قيم محدودة) مع رسالة خطأ واضحة. |
| **حالة التحميل (Loading)** | عند جلب بيانات غير متوفرة فوراً (مثلاً من Firestore)، عرض "جاري التحميل..." أو ما يعادله بدلاً من بيانات محلية قديمة أو فارغة. |
| **الأمان** | لا أسرار مكتوبة في الكود (كود الدخول، API keys). إن وُجدت، التعليق يوضح أنها للحماية على مستوى التطبيق وليست حماية كاملة. |

---

## 3. خطوات التنفيذ أثناء المراجعة

1. **اقرأ الملفات المعنية كاملة** (أو على الأقل الدوال والـ hooks المرتبطة بالمسار الذي تراجعه).
2. **تتبع مسار واحد من البداية للنهاية** (مثلاً: ضغط "دخول" → التحقق من الكود → حفظ الجلسة → إعادة التوجيه).
3. **تحقق من المسارات البديلة**: ماذا يحدث عند فشل التحقق؟ عند إلغاء المعاينة؟ عند عدم توفر Firestore؟
4. **ابحث عن الحالات التي لم تُعالَج**: قيم `undefined`، استدعاء دوال بدون تحقق من وجود الكائن (مثل `firestoreDb`)، استخدام `sessionStorage` دون التحقق من وجوده في البيئة.
5. **شغّل `read_lints`** على الملفات المعدّلة أو المراجَعَة.
6. **شغّل الاختبارات** (`npm run test`) إن وُجدت؛ تأكد أنها تمر.
7. **اكتب تقريراً موجزاً**: ما تم التحقق منه (جدول أو قائمة)، أي تعديلات تمت إن وُجدت، أي ملاحظات (تحذيرات أو تحسينات مقترحة بدون تنفيذ).

---

## 4. شكل التقرير النهائي

بعد المراجعة قدّم:

- **جدول "ما تم التحقق منه"** مع الحالة (✅ / ⚠️ / ❌) وملاحظة قصيرة.
- **قسم "التعديلات التي تمت"** إن نفذت إصلاحات (مع ذكر الملف والسطر أو السلوك).
- **قسم "ملاحظات"** (اختياري): تحذيرات أمنية، اقتراحات لاحقة، دون تنفيذ إضافي إلا إذا طُلِب.

---

## 5. ربطها بالرولز العامة

- استخدم **قواعد general-engineering**: عدم التخمين، التحقق قبل "تم"، قراءة الكتلة الكاملة قبل التعديل.
- استخدم **قواعد tech-and-style**: فصل UI عن الخدمات، التحقق من null، عدم استخدام `any`.

---

**تذكير:** المراجعة الدقيقة = تتبع التدفق + قائمة التحقق + حالات حدية + read_lints + اختبارات. لا تقل "تمت المراجعة ولا مشاكل" دون تنفيذ الخطوات أعلاه.
