# سيناريوهات الاختبار الكامل (E2E) — عجلة الولاء

## تشغيل الاختبارات الآلية

```bash
npm run test:e2e
```

يشغّل Playwright على `http://localhost:5174` (يتطابق مع vite.config server port). التطبيق يُشغَّل تلقائياً إن لم يكن يعمل.

تشغيل التطبيق يدوياً: `npm run dev` ثم فتح العنوان المعروض (مثلاً http://localhost:5174).

---

## أ. صفحة الضيف (/) — السيناريوهات

### A1. تحميل الصفحة
| الخطوة | الإجراء | المتوقع |
|--------|---------|---------|
| 1 | فتح / | عنوان «عجلة الولاء»، لوجو، زر «اضغط هنا»، زر «اضغط للتسجيل مجاناً». |

### A2. مسار «اضغط هنا» (عضو حالي)
| الخطوة | الإجراء | المتوقع |
|--------|---------|---------|
| 1 | الضغط على «اضغط هنا» | تظهر شاشة «ادخل رقم جوالك». |
| 2 | إدخال رقم غير موجود في القاعدة (مثلاً 0511111111) وانتظار التحقق | تظهر رسالة تسجيل + حقول الاسم والهوية وزر «انضم لنا الان .. وجرّب حظك!». |
| 3 | إدخال رقم موجود في الفضي (بعد رفع إكسيل من الأدمن) | تظهر ترحيب مقنّع + زر «دور العجلة». |
| 4 | الضغط «دور العجلة» | شاشة تحميل ثم العجلة تدور وتوقف على جائزة. |
| 5 | بعد التوقف | شاشة الكود + زر نسخ/واتساب. |
| 6 | الضغط نسخ أو واتساب | الانتقال لشاشة الفئة + النقاط + واتساب. |

### A3. مسار «اضغط للتسجيل مجاناً»
| الخطوة | الإجراء | المتوقع |
|--------|---------|---------|
| 1 | الضغط «اضغط للتسجيل مجاناً» | شاشة «ادخل رقم جوالك». |
| 2 | إدخال 9+ أرقام (مثلاً 0522222222) | ظهور حقول الاسم والهوية. |
| 3 | إدخال اسم + هوية والضغط «انضم لنا الان .. وجرّب حظك!» | العجلة تفتح وتدور، ثم شاشة الكود. |

### A4. قلب البيانات (Lookup)
| الخطوة | الإجراء | المتوقع |
|--------|---------|---------|
| 1 | من الأدمن رفع إكسيل فضي فيه رقم (مثلاً 0533333333) وإيراد فيه نفس الرقم وإعداد «كل كم ريال = 1 نقطة» = 10 | — |
| 2 | من الضيف: «اضغط هنا» → إدخال 0533333333 | ترحيب + «دور العجلة». |
| 3 | بعد الدوران والانتقال لشاشة الفئة | فئة «فضي» + نقاط = (إيراد الرقم ÷ 10). |

### A5. شروط وأحكام
| الخطوة | الإجراء | المتوقع |
| 1 | الضغط على أيقونة الشروط بجانب العنوان | فتح مودال «شروط وأحكام». |
| 2 | الضغط خارج المودال أو زر الإغلاق | إغلاق المودال. |

---

## ب. صفحة الأدمن (/admin) — السيناريوهات

### B1. تحميل وفحص Firebase
| الخطوة | الإجراء | المتوقع |
|--------|---------|---------|
| 1 | فتح /admin | لوحة التحكم، صندوق «فحص Firebase»، 4 بطاقات رفع (فضي، ذهبي، بلاتيني، إيراد)، سجل العضويات الجديدة، الإعدادات. |
| 2 | قراءة صندوق فحص Firebase | أخضر = يعمل، برتقالي/أحمر = رسالة توضيحية. |

### B2. رفع الملفات
| الخطوة | الإجراء | المتوقع |
|--------|---------|---------|
| 1 | رفع ملف إكسيل للفضي (عمود جوال/اسم) | رسالة نجاح + تحديث العدد. |
| 2 | رفع ذهبي، بلاتيني، إيراد | نفس السلوك. |

### B3. الإعدادات
| الخطوة | الإجراء | المتوقع |
| 1 | تغيير «كل كم ريال = 1 نقطة» أو نقاط الترقية أو نصوص الرسائل | — |
| 2 | الضغط «حفظ الإعدادات» | رسالة نجاح. |

### B4. سجل العضويات الجديدة
| الخطوة | الإجراء | المتوقع |
| 1 | بعد تسجيل ضيف جديد من صفحة الضيف (A3 أو A2 مع تسجيل) | يظهر صف في «سجل العضويات الجديدة» (جوال، اسم، تاريخ). |
| 2 | الضغط «تحديث» | تحديث القائمة. |
| 3 | الضغط «مسح السجل» | تفريغ السجل ورسالة نجاح. |

### B5. الرابط للضيف
| الخطوة | الإجراء | المتوقع |
| 1 | الضغط «العودة لصفحة الزبون» | الانتقال إلى /. |

---

## ج. التكامل: ضيف جديد → ظهوره في الأدمن

| # | الإجراء | المتوقع |
|---|---------|---------|
| 1 | فتح /admin وتوثيق أن سجل العضويات الجديدة فارغ أو يحتوي N عناصر. | — |
| 2 | فتح / (تبويب جديد أو جهاز آخر). | — |
| 3 | «اضغط للتسجيل مجاناً» → إدخال رقم جديد (مثلاً 0599999999) + اسم + هوية → «انضم لنا الان .. وجرّب حظك!». | العجلة تدور ثم الكود. |
| 4 | العودة لـ /admin والضغط «تحديث» في سجل العضويات الجديدة. | يظهر صف للرقم 599999999 مع الاسم والتاريخ. |

---

## د. عناصر مساعدة للاختبار الآلي (data-testid)

- `btn-spin-request`: زر «اضغط هنا»
- `btn-skip-gift`: زر «اضغط للتسجيل مجاناً»
- `form-check-phone`: نموذج ادخل رقمك
- `input-phone`: حقل الجوال
- `input-name`: حقل الاسم (عند ظهور نموذج التسجيل)
- `input-id`: حقل الهوية
- `btn-lookup`: زر «استعلم عن عضويتك»
- `btn-register-and-spin`: زر «انضم لنا الان .. وجرّب حظك!»
- `btn-spin-wheel`: زر «دور العجلة» (للعميل المُعرّف)

يمكن استخدامها في Playwright: `page.getByTestId('btn-skip-gift').click()`.

## الاختبارات الآلية (e2e/)

| الملف | السيناريو |
|-------|-----------|
| `e2e/guest-lookup.spec.ts` | فتح /، إدخال رقم، ظهور زر استعلام؛ مسار التسجيل المجاني مع ظهور حقول الاسم والهوية |
