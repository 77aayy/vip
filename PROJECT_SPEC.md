# QR Loyalty System — مواصفات المشروع (محدّثة)

## الهدف
العجلة هي **عرض وإغراء** للزبون عشان يدخل ويعرف عضويته. أول ما يمسح QR يلاقي العجلة → يكسب الجائزة → يظهر له الكود. أول ما يدوس **نسخ** أو **إرسال واتساب** تظهر له فئته (إن كان مسجّل) أو يُطلب منه التسجيل (إن كان جديداً). النقاط تُحسب من **كشف الإيراد** اللي الأدمن يرفعه.

---

## 1. واجهة الأدمن (صفحة رفع الملفات)

**صفحة واحدة → رفع 4 ملفات:**

| # | الملف | الاستخدام |
|---|--------|-----------|
| 1 | **الزبائن الفضي** | من في الفئة الفضية |
| 2 | **الزبائن الذهبي** | من في الفئة الذهبية |
| 3 | **الزبائن البلاتيني** | من في الفئة البلاتينية |
| 4 | **كشف الإيراد** | مصدر **النقاط** (كل عميل وكم دفع → نحسب منه النقاط) |

**النقاط:**
- تُحسب من **كشف الإيراد** (مثلاً: العميل دفع 7,000 → حسب قاعدة التحويل = 10,000 نقطة).
- الأدمن يحدد: كم ريال (أو وحدة إيراد) = كم نقطة، وكم نقطة للانتقال: فضي→ذهبي ، ذهبي→بلاتيني.

**ما يتحكم فيه الأدمن من نفس الصفحة/الإعدادات:**
- رفع الملفات الأربعة.
- قاعدة تحويل الإيراد → نقاط.
- حدود النقاط للترقية (فضي→ذهبي ، ذهبي→بلاتيني).
- نصوص الرسائل (تهنئة، تشجيع، التسجيل).

---

## 2. سير عمل الزبون (عند مسح QR)

### المرحلة 1: العجلة (أول ما يفتح)
- **أول حاجة يشوفها = العجلة.**
- يلعب → يكسب الجائزة → **يظهر له الكود** (كود الاسترداد).

### المرحلة 2: عند ضغط "نسخ" أو "إرسال واتساب"
هنا النظام يعرف: هل الزبون مسجّل ولا جديد.

---

### 2 أ — لو **مسجّل** (رقمه موجود في قاعدة البيانات: فضي / ذهبي / بلاتيني)

- **تظهر له فوراً:**
  - رسالة التهنئة + **فئته** (فضي / ذهبي / بلاتيني).
  - **نقاطه الحالية** (محسوبة من كشف الإيراد).
  - **كم نقطة للوصول للفئة التالية** (إن لم يكن بلاتيني).

**أمثلة (والنصوص يضبطها الأدمن):**

| الفئة | مثال الرسالة |
|--------|-----------------|
| **فضي** | "أنت عميل فضي، معك 7,000 نقطة. الرجاء الاستمرار للوصول إلى 10,000 نقطة للانتقال إلى الذهبي." |
| **ذهبي** | "أنت عميل ذهبي، معك 10,000 نقطة. الرجاء الاستمرار للوصول إلى 12,000 نقطة للانتقال من ذهبي إلى بلاتيني." |
| **بلاتيني** | "أهلاً عميلنا العزيز، أنت الآن في أعلى فئة: البلاتيني." |

- مع عرض **الكود** وزر **إرسال واتساب** (الرسالة تروح للاستقبال: كود + بيانات الزبون).

---

### 2 ب — لو **غير مسجّل** (أول مرة، غير مصنّف في فضي/ذهبي/بلاتيني)

- **لا نعرض فئة** — نعرض له طلب التسجيل:
  - **"أدخل رقم جوالك واسمك وهويتك للتسجيل في عضوية الولاء للحصول على الهدية والخصم والدخول في العضوية الفضية."**
- بعد إدخال (رقم جوال + اسم + هوية) وحفظ البيانات:
  - نعرض له **الكود** وزر **إرسال واتساب**.
  - رسالة واتساب للاستقبال تحتوي الكود + بياناته عشان الاستقبال يعمل له عضوية فضية ويستلم الجائزة.

---

## 3. إرسال واتساب والاستقبال

- عند **إرسال واتساب**: الرسالة تروح **للاستقبال** (كود + بيانات الزبون).
- بعد الإرسال يظهر للزبون:
  - **"تم وصول الرسالة إلى الاستقبال بنجاح. توجه إلى الاستقبال لاستلام الجائزة."**

---

## 4. ملخص التدفق

```
مسح QR
  → أول ما يفتح: العجلة (عرض / إغراء)
  → يلعب → يكسب → يظهر الكود
  → يضغط "نسخ" أو "إرسال واتساب"
      → النظام يطلب رقم الجوال (إن لم يُدخل مسبقاً) أو يستخدمه للبحث
      → بحث فوري في قاعدة البيانات (الملفات الأربعة)
      → إن مسجّل (فضي/ذهبي/بلاتيني):
          → عرض فئته + نقاطه (من كشف الإيراد) + النقاط المتبقية للترقية + الكود + واتساب
      → إن غير مسجّل:
          → "أدخل رقم جوالك واسمك وهويتك للتسجيل في عضوية الولاء للحصول على الهدية والخصم والدخول في العضوية الفضية"
          → إدخال البيانات → حفظ → عرض الكود + واتساب
  → واتساب يذهب للاستقبال (كود + بيانات الزبون)
  → رسالة للزبون: "تم وصول الرسالة إلى الاستقبال بنجاح. توجه إلى الاستقبال لاستلام الجائزة."
```

---

## 5. مصدر النقاط والفئات

- **كشف الإيراد (الملف الرابع):** يحدد **كم أنفق كل عميل** → منه نحسب **النقاط** (حسب قاعدة التحويل اللي يضبطها الأدمن).
- **ملفات فضي / ذهبي / بلاتيني:** تحدد **من في أي فئة** (أو تُستنتج الفئة من النقاط حسب حدود الترقية).
- الزبائن المسجّلون (اللي في القاعدة) **يتابعون نقاط عضوياتهم** عبر هذه البيانات؛ الرسالة اللي تظهر لهم تعكس النقاط الحالية والمتبقية للترقية.

---

## 6. ما يتحكم فيه الأدمن

- رفع الملفات الأربعة (فضي، ذهبي، بلاتيني، كشف الإيراد).
- قاعدة التحويل: إيراد → نقاط (مثلاً X ريال = Y نقطة).
- حدود النقاط: للانتقال من فضي→ذهبي ، من ذهبي→بلاتيني.
- نصوص الرسائل (تهنئة فضي/ذهبي/بلاتيني، ونص طلب التسجيل للجدد).
- إعداد العجلة والجوائز (إن وُجدت).

---

## 7. المتطلبات التقنية

- **قاعدة البيانات:** Firebase — بيانات الملفات الأربعة بعد الرفع، والبحث فوري عند إدخال الرقم.
- **الوصول الفوري:** بيانات الزبون وإرسال واتساب تصل لحظياً (لوحة تحكم / كمبيوتر).
- **واجهة الزبون:** PWA تفتح من مسح QR (عجلة أولاً ثم الكود ثم الفئة/التسجيل).

---

## 8. التسليمات المطلوبة

- [ ] واجهة أدمن: رفع 4 ملفات + إعداد التحويل (إيراد→نقاط) وحدود الترقية + نصوص الرسائل.
- [ ] واجهة الزبون: مسح QR → عجلة → جائزة → كود → عند نسخ/واتساب: إما فئة + نقاط + كود + واتساب (إن مسجّل)، أو نموذج تسجيل (جوال + اسم + هوية) ثم كود + واتساب (إن جديد).
- [ ] عرض النقاط الحالية والمتبقية للترقية للزبون المسجّل (من كشف الإيراد).
- [ ] إرسال واتساب للاستقبال (كود + بيانات الزبون).
- [ ] رسالة تأكيد: "تم وصول الرسالة إلى الاستقبال بنجاح. توجه إلى الاستقبال لاستلام الجائزة."
- [ ] حفظ البيانات في Firebase ووصولها فوراً.

إذا حابب نعدّل أي نص أو ترتيب (مثلاً متى بالضبط نطلب رقم الجوال)، اذكر التعديل ونحدّث المواصفات.
